<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VyuhMitra - AI-Powered Train Traffic Control Dashboard</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <!-- Main Dashboard Container -->
    <div class="dashboard-container">
        
        <!-- Header with System Status -->
        <header class="dashboard-header">
            <div class="header-left">
                <h1>üöÇ VyuhMitra Control Center</h1>
                <div class="section-info">
                    <span class="section-badge" id="section-name">NDLS ‚Üí AGC</span>
                    <span class="status-badge" id="system-status">Initializing</span>
                </div>
            </div>
            <div class="header-right">
                <div class="live-indicators">
                    <div class="indicator" id="api-status">
                        <span class="indicator-dot"></span>
                        <span>API Status</span>
                    </div>
                    <div class="indicator" id="data-feed">
                        <span class="indicator-dot"></span>
                        <span>Live Data</span>
                    </div>
                    <div class="indicator" id="ai-system">
                        <span class="indicator-dot"></span>
                        <span>AI System</span>
                    </div>
                </div>
                <button id="refresh-btn" class="refresh-btn">üîÑ Refresh</button>
            </div>
        </header>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid">
            
            <!-- 1. Live Section Overview (Current Status Board) -->
            <div class="panel section-overview">
                <div class="panel-header">
                    <h2>üöâ Live Section Overview</h2>
                    <div class="view-controls">
                        <button class="view-btn active" data-view="map">Map View</button>
                        <button class="view-btn" data-view="table">Table View</button>
                    </div>
                </div>
                
                <!-- Train Map View -->
                <div id="map-view" class="view-content active">
                    <div class="track-schematic">
                        <div class="station-node" data-station="NDLS">
                            <span class="station-name">NDLS</span>
                            <div class="platform-status">
                                <div class="platform" data-platform="1">P1</div>
                                <div class="platform" data-platform="2">P2</div>
                                <div class="platform" data-platform="3">P3</div>
                            </div>
                        </div>
                        <div class="track-line">
                            <div class="train-marker" id="train-marker-1" style="left: 20%;">
                                <span class="train-id">12002</span>
                            </div>
                        </div>
                        <div class="station-node" data-station="AGC">
                            <span class="station-name">AGC</span>
                            <div class="platform-status">
                                <div class="platform" data-platform="1">P1</div>
                                <div class="platform" data-platform="2">P2</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Train Status Table -->
                <div id="table-view" class="view-content">
                    <div class="table-container">
                        <table class="status-table">
                            <thead>
                                <tr>
                                    <th>Train ID</th>
                                    <th>Name</th>
                                    <th>Current Location</th>
                                    <th>Scheduled</th>
                                    <th>Actual</th>
                                    <th>Delay</th>
                                    <th>Priority</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="trains-table-body">
                                <tr class="loading-row">
                                    <td colspan="8">Loading live train data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 2. AI-Powered Suggestions Panel (Decision Support) -->
            <div class="panel ai-suggestions">
                <div class="panel-header">
                    <h2>ü§ñ AI Decision Support</h2>
                    <div class="ai-stats">
                        <span class="stat">Confidence: <span id="ai-confidence">87%</span></span>
                        <span class="stat">Solutions: <span id="solutions-count">0</span></span>
                    </div>
                </div>
                
                <!-- Conflict Detection -->
                <div class="conflict-detection">
                    <h3>‚ö†Ô∏è Detected Conflicts</h3>
                    <div id="conflicts-list" class="conflicts-container">
                        <div class="no-conflicts">
                            <span>üü¢ No conflicts detected</span>
                        </div>
                    </div>
                </div>
                
                <!-- AI Recommendations -->
                <div class="recommendations">
                    <h3>üí° Recommended Actions</h3>
                    <div id="recommendations-list" class="recommendations-container">
                        <div class="no-recommendations">
                            <span>AI analyzing current situation...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Controller Actions -->
                <div class="controller-actions">
                    <button class="action-btn accept" id="accept-solution">‚úÖ Accept</button>
                    <button class="action-btn adjust" id="adjust-solution">‚úèÔ∏è Adjust & Accept</button>
                    <button class="action-btn reject" id="reject-solution">‚ùå Reject</button>
                </div>
            </div>

            <!-- 3. What-If Scenario Simulator -->
            <div class="panel scenario-simulator">
                <div class="panel-header">
                    <h2>üîÆ What-If Scenario Simulator</h2>
                    <button class="simulate-btn" id="run-simulation">‚ñ∂Ô∏è Run Simulation</button>
                </div>
                
                <div class="scenario-inputs">
                    <div class="input-group">
                        <label>Scenario Type:</label>
                        <select id="scenario-type">
                            <option value="delay">Train Delay</option>
                            <option value="track_closure">Track Closure</option>
                            <option value="weather">Weather Disruption</option>
                            <option value="emergency">Emergency</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Affected Train:</label>
                        <select id="affected-train">
                            <option value="">Select train...</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Impact (minutes):</label>
                        <input type="number" id="impact-duration" min="5" max="120" value="15">
                    </div>
                </div>
                
                <div class="simulation-results" id="simulation-results">
                    <div class="no-simulation">
                        <span>Configure scenario and run simulation</span>
                    </div>
                </div>
            </div>

            <!-- 4. KPI & Performance Dashboard -->
            <div class="panel kpi-dashboard">
                <div class="panel-header">
                    <h2>üìä Live KPIs & Performance</h2>
                    <div class="kpi-period">
                        <select id="kpi-period">
                            <option value="live">Live</option>
                            <option value="hour">Last Hour</option>
                            <option value="day">Today</option>
                        </select>
                    </div>
                </div>
                
                <div class="kpi-grid">
                    <div class="kpi-card throughput">
                        <div class="kpi-icon">üöä</div>
                        <div class="kpi-value" id="throughput-value">0.0</div>
                        <div class="kpi-label">Trains/Hour</div>
                        <div class="kpi-change" id="throughput-change">--</div>
                    </div>
                    <div class="kpi-card delay">
                        <div class="kpi-icon">‚è±Ô∏è</div>
                        <div class="kpi-value" id="delay-value">0</div>
                        <div class="kpi-label">Avg Delay (min)</div>
                        <div class="kpi-change" id="delay-change">--</div>
                    </div>
                    <div class="kpi-card utilization">
                        <div class="kpi-icon">üìà</div>
                        <div class="kpi-value" id="utilization-value">0%</div>
                        <div class="kpi-label">Track Utilization</div>
                        <div class="kpi-change" id="utilization-change">--</div>
                    </div>
                    <div class="kpi-card punctuality">
                        <div class="kpi-icon">üéØ</div>
                        <div class="kpi-value" id="punctuality-value">0%</div>
                        <div class="kpi-label">Punctuality Rate</div>
                        <div class="kpi-change" id="punctuality-change">--</div>
                    </div>
                </div>
                
                <div class="performance-chart">
                    <canvas id="performance-chart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- 5. Override & Manual Control Panel -->
            <div class="panel manual-control">
                <div class="panel-header">
                    <h2>üéõÔ∏è Manual Override & Control</h2>
                    <div class="control-mode">
                        <label class="switch">
                            <input type="checkbox" id="manual-mode">
                            <span class="slider">Manual Mode</span>
                        </label>
                    </div>
                </div>
                
                <div class="manual-inputs">
                    <div class="input-group">
                        <label>Train ID:</label>
                        <input type="text" id="manual-train-id" placeholder="Enter train number">
                    </div>
                    <div class="input-group">
                        <label>Action:</label>
                        <select id="manual-action">
                            <option value="hold">Hold at Station</option>
                            <option value="reroute">Change Route</option>
                            <option value="priority">Change Priority</option>
                            <option value="speed">Adjust Speed</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Reason:</label>
                        <select id="override-reason">
                            <option value="safety">Safety Concern</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="emergency">Emergency</option>
                            <option value="operational">Operational Need</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div class="manual-actions">
                    <button class="action-btn execute" id="execute-manual">Execute Override</button>
                    <button class="action-btn cancel" id="cancel-manual">Cancel</button>
                </div>
                
                <!-- Audit Trail -->
                <div class="audit-trail">
                    <h3>üìã Recent Actions</h3>
                    <div id="audit-list" class="audit-container">
                        <div class="no-actions">
                            <span>No recent actions</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 6. System Integration & Data Feeds -->
            <div class="panel system-status">
                <div class="panel-header">
                    <h2>üîó System Integration Status</h2>
                    <div class="last-update">
                        Last Update: <span id="last-update-time">--:--</span>
                    </div>
                </div>
                
                <div class="integration-status">
                    <div class="integration-item" id="railradar-status">
                        <div class="integration-icon">üöÇ</div>
                        <div class="integration-info">
                            <div class="integration-name">RailRadar API</div>
                            <div class="integration-status-text">Connecting...</div>
                        </div>
                        <div class="integration-indicator"></div>
                    </div>
                    
                    <div class="integration-item" id="gemini-status">
                        <div class="integration-icon">üß†</div>
                        <div class="integration-info">
                            <div class="integration-name">Gemini AI</div>
                            <div class="integration-status-text">Ready</div>
                        </div>
                        <div class="integration-indicator active"></div>
                    </div>
                    
                    <div class="integration-item" id="ml-status">
                        <div class="integration-icon">‚ö°</div>
                        <div class="integration-info">
                            <div class="integration-name">ML Models</div>
                            <div class="integration-status-text">Loaded</div>
                        </div>
                        <div class="integration-indicator active"></div>
                    </div>
                </div>
                
                <div class="error-alerts" id="error-alerts">
                    <h3>‚ö†Ô∏è System Alerts</h3>
                    <div class="alerts-container">
                        <div class="no-alerts">
                            <span>üü¢ All systems operational</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Solution Details Modal -->
    <div id="solution-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Solution Details</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Solution details will be populated here -->
            </div>
            <div class="modal-footer">
                <button id="modal-accept" class="action-btn accept">‚úÖ Accept Solution</button>
                <button id="modal-adjust" class="action-btn adjust">‚úèÔ∏è Adjust & Accept</button>
                <button id="modal-reject" class="action-btn reject">‚ùå Reject Solution</button>
                <button id="modal-close" class="action-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Reason Input Modal -->
    <div id="reason-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ü§î Abnormality Reason</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Please specify the reason for this abnormality to help our AI generate better solutions:</p>
                <div class="reason-options">
                    <label><input type="radio" name="reason" value="technical_failure"> Technical Failure</label>
                    <label><input type="radio" name="reason" value="signal_issue"> Signal Issue</label>
                    <label><input type="radio" name="reason" value="track_obstruction"> Track Obstruction</label>
                    <label><input type="radio" name="reason" value="weather"> Weather Disruption</label>
                    <label><input type="radio" name="reason" value="crew_shortage"> Crew Shortage</label>
                    <label><input type="radio" name="reason" value="maintenance"> Engineering Work</label>
                    <label><input type="radio" name="reason" value="congestion"> Station Congestion</label>
                    <label><input type="radio" name="reason" value="other"> Other</label>
                </div>
                <textarea id="reason-details" placeholder="Additional details (optional)..."></textarea>
            </div>
            <div class="modal-footer">
                <button id="reason-submit" class="action-btn accept">Submit & Generate Solutions</button>
                <button id="reason-skip" class="action-btn adjust">Skip & Generate Anyway</button>
                <button id="reason-cancel" class="action-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/dashboard.js"></script>
</body>
</html>
